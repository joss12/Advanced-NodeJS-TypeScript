"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.importProviders = void 0;
const di_1 = require("@tsed/di");
const importComponents_1 = require("./importComponents");
async function importProviders(injector) {
    injector.logger.debug("Scan components");
    const providers = await importAll(injector.settings);
    return providers.filter((provider) => !!provider.route).map(({ route, token }) => ({ route, token }));
}
exports.importProviders = importProviders;
async function importAll(settings) {
    const results = await Promise.all([
        importComponents_1.importComponents(settings.imports, settings.exclude),
        importComponents_1.importComponents(settings.mount, settings.exclude),
        importComponents_1.importComponents(settings.componentsScan, settings.exclude)
    ]);
    const providers = [].concat(...results);
    const promises = providers
        .map(({ token }) => di_1.GlobalProviders.get(token))
        .filter((provider) => (provider === null || provider === void 0 ? void 0 : provider.type) === di_1.ProviderType.MODULE && provider.configuration)
        .map((provider) => importAll({ exclude: settings.exclude, ...provider.configuration }));
    return [].concat(...(await Promise.all(promises)), providers);
}
//# sourceMappingURL=importProviders.js.map