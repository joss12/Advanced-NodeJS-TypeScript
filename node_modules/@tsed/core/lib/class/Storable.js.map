{"version":3,"file":"Storable.js","sourceRoot":"","sources":["../../src/class/Storable.ts"],"names":[],"mappings":";;;AACA,sDAAuF;AACvF,qCAAgC;AAChC,yCAAoC;AACpC,mCAA8B;AAE9B;;GAEG;AACH,MAAsB,QAAS,SAAQ,eAAM;IAO3C,YAAY,MAAiB,EAAE,WAA4B,EAAE,KAAmC;QAC9F,KAAK,CAAC;YACJ,MAAM;YACN,WAAW;YACX,KAAK,EAAE,CAAC,sBAAQ,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,SAAS,CAAQ;YACnD,UAAU,EAAE,sBAAQ,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,SAAS;SAChD,CAAC,CAAC;QAEH,IAAI,CAAC,OAAO,GAAG,MAAM,CAAC;QACtB,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC;QAEnB,IAAI,MAAM,EAAE;YACV,IAAI,CAAC,MAAM,GAAG,aAAK,CAAC,IAAI,CAAC,MAAM,EAAE,WAAW,EAAE,KAAK,CAAC,CAAC;SACtD;IACH,CAAC;IAED;;;OAGG;IACH,IAAI,MAAM;QACR,OAAO,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,qBAAO,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC;IAC7D,CAAC;IAED;;;OAGG;IACH,IAAI,IAAI;QACN,OAAO,IAAI,CAAC,KAAK,CAAC;IACpB,CAAC;IAED;;;OAGG;IACH,IAAI,IAAI,CAAC,KAAgB;QACvB,IAAI,CAAC,KAAK,GAAG,KAAK,IAAI,MAAM,CAAC;IAC/B,CAAC;IAED;;;OAGG;IACH,IAAW,KAAK;QACd,OAAO,IAAI,CAAC,MAAM,CAAC;IACrB,CAAC;IAES,KAAK,CAAC,MAAiB;QAC/B,IAAI,MAAM,IAAI,IAAI,CAAC,OAAO,EAAE;YAC1B,IAAI,IAAI,CAAC;YAET,IAAI,OAAO,IAAI,CAAC,KAAK,KAAK,QAAQ,EAAE;gBAClC,IAAI,GAAG,mBAAQ,CAAC,aAAa,CAAC,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC,WAAW,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;aAC3E;iBAAM;gBACL,IAAI,GAAG,mBAAQ,CAAC,OAAO,CAAC,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC,WAAW,CAAC,CAAC;aACzD;YAED,IAAI,0BAAY,CAAC,IAAI,CAAC,EAAE;gBACtB,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC;gBAC3B,IAAI,CAAC,KAAK,GAAG,MAAM,CAAC;aACrB;iBAAM;gBACL,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC;aACnB;YACD,IAAI,CAAC,IAAI,GAAG,oBAAM,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;SACtC;IACH,CAAC;CACF;AA1ED,4BA0EC","sourcesContent":["import {Type} from \"../interfaces\";\nimport {classOf, isCollection, isNumber, isObject, nameOf} from \"../utils/ObjectUtils\";\nimport {Entity} from \"./Entity\";\nimport {Metadata} from \"./Metadata\";\nimport {Store} from \"./Store\";\n\n/**\n * @deprecated Will be removed in v6\n */\nexport abstract class Storable extends Entity {\n  /**\n   * Custom name.\n   */\n  public name: string;\n  protected _store: Store;\n\n  constructor(target: Type<any>, propertyKey: string | symbol, index?: number | PropertyDescriptor) {\n    super({\n      target,\n      propertyKey,\n      index: (isNumber(index) ? index : undefined) as any,\n      descriptor: isObject(index) ? index : undefined\n    });\n\n    this._target = target;\n    this.build(target);\n\n    if (target) {\n      this._store = Store.from(target, propertyKey, index);\n    }\n  }\n\n  /**\n   * Class of the entity.\n   * @returns {Type<any>}\n   */\n  get target(): Type<any> {\n    return this._target ? classOf(this._target) : this._target;\n  }\n\n  /**\n   *\n   * @returns {Type<any>}\n   */\n  get type(): Type<any> {\n    return this._type;\n  }\n\n  /**\n   *\n   * @param value\n   */\n  set type(value: Type<any>) {\n    this._type = value || Object;\n  }\n\n  /**\n   *\n   * @returns {Store}\n   */\n  public get store(): Store {\n    return this._store;\n  }\n\n  protected build(target: Type<any>) {\n    if (target && this._target) {\n      let type;\n\n      if (typeof this.index === \"number\") {\n        type = Metadata.getParamTypes(this._target, this.propertyKey)[this.index];\n      } else {\n        type = Metadata.getType(this._target, this.propertyKey);\n      }\n\n      if (isCollection(type)) {\n        this.collectionType = type;\n        this._type = Object;\n      } else {\n        this._type = type;\n      }\n      this.name = nameOf(this.propertyKey);\n    }\n  }\n}\n"]}